# ðŸš€ åŸŸåè¿ç§»æ‰§è¡ŒæŒ‡å— - ä»ŽIPåˆ°åŸŸå

## ðŸ“‹ æ€»è§ˆ

**ç›®æ ‡**ï¼šå°†åŽç«¯APIä»Ž `http://8.140.9.139:8080` è¿ç§»åˆ° `https://api.ai-menu.tech`

**é¢„è®¡æ—¶é—´**ï¼š1-2å°æ—¶

**éš¾åº¦**ï¼šâ­â­â­ ä¸­ç­‰

---

## ðŸ”§ ç¬¬ä¸€é˜¶æ®µï¼šæ£€æŸ¥å½“å‰ECSçŠ¶æ€ï¼ˆ15åˆ†é’Ÿï¼‰

### æ­¥éª¤1ï¼šä¸Šä¼ æ£€æŸ¥è„šæœ¬åˆ°ECS

åœ¨æ‚¨çš„**æœ¬åœ°ç”µè„‘**è¿è¡Œï¼š

```bash
cd /Users/apple/ai-menu-100

# ä¸Šä¼ æ£€æŸ¥è„šæœ¬åˆ°ECS
scp check-ecs-status.sh root@8.140.9.139:/root/

# å¦‚æžœæç¤ºè¾“å…¥å¯†ç ï¼Œè¾“å…¥ECSçš„rootå¯†ç 
```

### æ­¥éª¤2ï¼šSSHç™»å½•ECSå¹¶è¿è¡Œæ£€æŸ¥

```bash
# ç™»å½•ECS
ssh root@8.140.9.139

# è¿è¡Œæ£€æŸ¥è„šæœ¬
chmod +x /root/check-ecs-status.sh
/root/check-ecs-status.sh

# æŠŠè¾“å‡ºç»“æžœå‘ç»™æˆ‘ï¼
```

**æˆ‘éœ€è¦çœ‹åˆ°çš„ä¿¡æ¯ï¼š**
- âœ… Nginxæ˜¯å¦å·²å®‰è£…ï¼Ÿ
- âœ… Certbotæ˜¯å¦å·²å®‰è£…ï¼Ÿ
- âœ… åŽç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ
- âœ… å½“å‰CORSé…ç½®æ˜¯ä»€ä¹ˆï¼Ÿ

---

## ðŸŒ ç¬¬äºŒé˜¶æ®µï¼šé…ç½®DNSè§£æžï¼ˆ20åˆ†é’Ÿï¼‰

### å…³é”®é—®é¢˜ï¼šai-menu.tech åŸŸååœ¨å“ªé‡Œç®¡ç†ï¼Ÿ

**è¯·å…ˆå›žç­”ä»¥ä¸‹é—®é¢˜ï¼š**

1. æ‚¨è®°å¾—è¿™ä¸ªåŸŸåæ˜¯åœ¨å“ªé‡Œä¹°çš„å—ï¼Ÿ
   - [ ] Namecheap
   - [ ] GoDaddy
   - [ ] Cloudflare
   - [ ] é˜¿é‡Œäº‘
   - [ ] å…¶ä»–ï¼š__________
   - [ ] ä¸è®°å¾—äº†

2. å¦‚æžœä¸è®°å¾—ï¼Œè¯·è¿è¡Œï¼ˆåœ¨æœ¬åœ°Macä¸Šï¼‰ï¼š
```bash
whois ai-menu.tech | grep -i "registrar"
```

### é…ç½®DNSè®°å½•

æ‰¾åˆ°åŸŸåç®¡ç†é¡µé¢åŽï¼Œå‚è€ƒã€ŠåŸŸåè§£æžé…ç½®æŒ‡å—.mdã€‹æ·»åŠ ä»¥ä¸‹è®°å½•ï¼š

```
è®°å½•1:
ç±»åž‹: A
ä¸»æœºè®°å½•: api
è®°å½•å€¼: 8.140.9.139

è®°å½•2:
ç±»åž‹: CNAME
ä¸»æœºè®°å½•: app
è®°å½•å€¼: cname.vercel-dns.com

è®°å½•3:
ç±»åž‹: CNAME
ä¸»æœºè®°å½•: admin
è®°å½•å€¼: cname.vercel-dns.com
```

### éªŒè¯DNSæ˜¯å¦ç”Ÿæ•ˆ

```bash
# åœ¨æœ¬åœ°Macè¿è¡Œ
nslookup api.ai-menu.tech

# æœŸæœ›è¾“å‡ºï¼š
# Name:    api.ai-menu.tech
# Address: 8.140.9.139

# å¦‚æžœè¿˜æ²¡ç”Ÿæ•ˆï¼Œä¼šæ˜¾ç¤ºæ‰¾ä¸åˆ°æˆ–å…¶ä»–IP
# è¯·ç­‰å¾…5-10åˆ†é’ŸåŽé‡è¯•
```

---

## ðŸ”’ ç¬¬ä¸‰é˜¶æ®µï¼šé…ç½®Nginxå’ŒHTTPSï¼ˆ30åˆ†é’Ÿï¼‰

### è¿™ä¸€æ­¥éœ€è¦åœ¨DNSç”Ÿæ•ˆåŽæ‰èƒ½æ‰§è¡Œï¼

åœ¨ECSä¸Šï¼ˆSSHè¿žæŽ¥çŠ¶æ€ï¼‰è¿è¡Œï¼š

```bash
# 1. ç¡®è®¤DNSå·²ç”Ÿæ•ˆ
nslookup api.ai-menu.tech

# 2. æ£€æŸ¥/å®‰è£…Nginx
if ! command -v nginx &> /dev/null; then
    echo "æ­£åœ¨å®‰è£…Nginx..."
    apt update
    apt install -y nginx
fi

# 3. å®‰è£…Certbotï¼ˆç”¨äºŽå…è´¹SSLè¯ä¹¦ï¼‰
if ! command -v certbot &> /dev/null; then
    echo "æ­£åœ¨å®‰è£…Certbot..."
    apt install -y certbot python3-certbot-nginx
fi

# 4. åˆ›å»ºNginxé…ç½®
cat > /etc/nginx/sites-available/ai-menu-api << 'EOF'
server {
    listen 80;
    server_name api.ai-menu.tech;
    
    # ä¸´æ—¶ï¼šå…è®¸Let's EncryptéªŒè¯
    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    location /health {
        access_log off;
        proxy_pass http://localhost:8080/health;
    }
}
EOF

# 5. å¯ç”¨é…ç½®
ln -sf /etc/nginx/sites-available/ai-menu-api /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default

# 6. æµ‹è¯•Nginxé…ç½®
nginx -t

# 7. é‡å¯Nginx
systemctl restart nginx
systemctl enable nginx

# 8. æµ‹è¯•HTTPè®¿é—®ï¼ˆåº”è¯¥èƒ½è®¿é—®ï¼‰
curl http://api.ai-menu.tech/health

# 9. ç”³è¯·SSLè¯ä¹¦ï¼ˆé‡è¦ï¼ï¼‰
certbot --nginx -d api.ai-menu.tech --non-interactive --agree-tos --email your_email@example.com

# âš ï¸ æ³¨æ„ï¼šæŠŠ your_email@example.com æ”¹æˆçœŸå®žé‚®ç®±

# 10. æµ‹è¯•HTTPSè®¿é—®
curl https://api.ai-menu.tech/health

# å¦‚æžœè¿”å›ž {"status":"ok"} å°±æˆåŠŸäº†ï¼
```

---

## ðŸŽ¨ ç¬¬å››é˜¶æ®µï¼šæ›´æ–°VercelçŽ¯å¢ƒå˜é‡ï¼ˆ15åˆ†é’Ÿï¼‰

### æ­¥éª¤1ï¼šç™»å½•Vercel

1. è®¿é—®ï¼šhttps://vercel.com/
2. ç™»å½•æ‚¨çš„è´¦å·
3. æ‰¾åˆ° ai-menu-100 é¡¹ç›®

### æ­¥éª¤2ï¼šæ›´æ–°çŽ¯å¢ƒå˜é‡

1. ç‚¹å‡»é¡¹ç›® â†’ Settings â†’ Environment Variables
2. æ‰¾åˆ° `NEXT_PUBLIC_API_URL`
3. ç‚¹å‡»ç¼–è¾‘ï¼ˆç¬”å›¾æ ‡ï¼‰
4. å°†å€¼ä»Ž `http://8.140.9.139:8080` æ”¹ä¸º `https://api.ai-menu.tech`
5. ç‚¹å‡» Save

**é‡è¦**ï¼šéœ€è¦å¯¹ä»¥ä¸‹çŽ¯å¢ƒç”Ÿæ•ˆï¼š
- [ ] Production
- [ ] Preview
- [ ] Development

### æ­¥éª¤3ï¼šé‡æ–°éƒ¨ç½²

1. åœ¨Vercelé¡¹ç›®é¡µé¢ï¼Œç‚¹å‡» "Deployments"
2. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²æ—è¾¹çš„ "..." æŒ‰é’®
3. é€‰æ‹© "Redeploy"
4. ç­‰å¾…3-5åˆ†é’Ÿæž„å»ºå®Œæˆ

---

## âœ… ç¬¬äº”é˜¶æ®µï¼šå…¨é¢æµ‹è¯•ï¼ˆ20åˆ†é’Ÿï¼‰

### æµ‹è¯•1ï¼šåŽç«¯API

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://api.ai-menu.tech/health

# åº”è¿”å›žï¼š{"status":"ok"}

# æµ‹è¯•ç™»å½•æŽ¥å£
curl -X POST https://api.ai-menu.tech/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"ä½ çš„ç®¡ç†å‘˜å¯†ç "}'

# åº”è¿”å›žJWT token
```

### æµ‹è¯•2ï¼šå‰ç«¯é¡µé¢

è®¿é—®ä»¥ä¸‹URLï¼Œé€ä¸€æµ‹è¯•ï¼š

1. **ç”¨æˆ·å‰ç«¯**ï¼šhttps://app.ai-menu.tech
   - [ ] é¡µé¢èƒ½æ­£å¸¸æ‰“å¼€
   - [ ] æ²¡æœ‰CORSé”™è¯¯ï¼ˆæ‰“å¼€æµè§ˆå™¨æŽ§åˆ¶å°æŸ¥çœ‹ï¼‰
   - [ ] æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
   - [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸

2. **ç®¡ç†åŽå°**ï¼šhttps://admin.ai-menu.tech/admin/login
   - [ ] ç™»å½•é¡µé¢æ­£å¸¸
   - [ ] èƒ½æˆåŠŸç™»å½•
   - [ ] Dashboardæ•°æ®æ­£å¸¸æ˜¾ç¤º

### æµ‹è¯•3ï¼šæ ¸å¿ƒåŠŸèƒ½

æµ‹è¯•ä¹‹å‰å¤±æ•ˆçš„åŠŸèƒ½ï¼š

1. **ç”¨æˆ·æ³¨å†Œ**
   - è®¿é—®ï¼šhttps://app.ai-menu.tech
   - ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"
   - å¡«å†™æ³¨å†Œä¿¡æ¯
   - æäº¤æ³¨å†Œ
   - âœ… åº”è¯¥æˆåŠŸï¼ˆä¹‹å‰å¤±è´¥æ˜¯å› ä¸ºAPIä¸é€šï¼‰

2. **æ–‡ä»¶ä¸Šä¼ **
   - ç™»å½•åŽä¸Šä¼ Excelæ–‡ä»¶
   - âœ… åº”è¯¥èƒ½æˆåŠŸä¸Šä¼ å’Œè§£æž

3. **AIèœå•ç”Ÿæˆ**
   - é…ç½®å®Œèœå“åŽï¼Œç‚¹å‡»"ç”Ÿæˆèœå•"
   - âœ… åº”è¯¥èƒ½æˆåŠŸè°ƒç”¨DeepSeek APIç”Ÿæˆèœå•

---

## ðŸ”„ å›žæ»šæ–¹æ¡ˆï¼ˆå¦‚æžœå‡ºé—®é¢˜ï¼‰

å¦‚æžœæ–°åŸŸåæœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›žæ»šï¼š

```bash
# åœ¨Vercelï¼š
# 1. Environment Variables
# 2. NEXT_PUBLIC_API_URL æ”¹å›ž http://8.140.9.139:8080
# 3. Redeploy

# æˆ–è€…ç›´æŽ¥å›žæ»šåˆ°ä¸Šä¸€ä¸ªéƒ¨ç½²ç‰ˆæœ¬ï¼š
# Deployments â†’ é€‰æ‹©ä¸Šä¸€ä¸ªæˆåŠŸçš„éƒ¨ç½² â†’ Promote to Production
```

---

## ðŸ“Š æ‰§è¡Œæ£€æŸ¥æ¸…å•

### å‡†å¤‡é˜¶æ®µ
- [ ] å·²åˆ›å»ºæ£€æŸ¥è„šæœ¬
- [ ] å·²åˆ›å»ºåŸŸåè§£æžæŒ‡å—
- [ ] å·²å‡†å¤‡å¥½æ‰§è¡Œå‘½ä»¤

### æ‰§è¡Œé˜¶æ®µ
- [ ] å·²åœ¨ECSè¿è¡Œæ£€æŸ¥è„šæœ¬
- [ ] å·²é…ç½®DNSè§£æžï¼ˆapi/app/adminï¼‰
- [ ] å·²ç¡®è®¤DNSç”Ÿæ•ˆ
- [ ] å·²é…ç½®Nginx
- [ ] å·²ç”³è¯·SSLè¯ä¹¦
- [ ] å·²æ›´æ–°VercelçŽ¯å¢ƒå˜é‡
- [ ] å·²é‡æ–°éƒ¨ç½²Vercel

### æµ‹è¯•é˜¶æ®µ
- [ ] åŽç«¯APIå¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç™»å½•APIæµ‹è¯•é€šè¿‡
- [ ] å‰ç«¯é¡µé¢èƒ½æ­£å¸¸è®¿é—®
- [ ] æ³¨å†ŒåŠŸèƒ½æ¢å¤æ­£å¸¸
- [ ] ç™»å½•åŠŸèƒ½æ¢å¤æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ æ¢å¤æ­£å¸¸
- [ ] AIèœå•ç”Ÿæˆæ¢å¤æ­£å¸¸

---

## ðŸ†˜ é‡åˆ°é—®é¢˜æ—¶

### å¸¸è§é—®é¢˜å¿«é€Ÿè¯Šæ–­

1. **DNSä¸ç”Ÿæ•ˆ**
   - ç­‰å¾…10-30åˆ†é’Ÿ
   - è¿è¡Œï¼š`nslookup api.ai-menu.tech 8.8.8.8`
   - æ¸…é™¤æœ¬åœ°DNSç¼“å­˜ï¼š`sudo dscacheutil -flushcache`

2. **SSLè¯ä¹¦ç”³è¯·å¤±è´¥**
   - ç¡®è®¤DNSå·²å®Œå…¨ç”Ÿæ•ˆ
   - ç¡®è®¤80ç«¯å£å¯è®¿é—®
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`certbot --nginx -d api.ai-menu.tech -v`

3. **CORSé”™è¯¯**
   - æ£€æŸ¥åŽç«¯.envçš„CORS_ORIGINé…ç½®
   - åº”è¯¥æ˜¯ï¼š`CORS_ORIGIN=https://app.ai-menu.tech,https://admin.ai-menu.tech`
   - ä¿®æ”¹åŽé‡å¯ï¼š`pm2 restart ai-menu-backend`

4. **502 Bad Gateway**
   - åŽç«¯æœåŠ¡å¯èƒ½åœäº†
   - æ£€æŸ¥ï¼š`pm2 status`
   - é‡å¯ï¼š`pm2 restart ai-menu-backend`

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æŠŠä»¥ä¸‹ä¿¡æ¯å‘ç»™æˆ‘ï¼š

1. æ‰§è¡Œåˆ°å“ªä¸€æ­¥äº†ï¼Ÿ
2. é‡åˆ°ä»€ä¹ˆé”™è¯¯ä¿¡æ¯ï¼Ÿ
3. æ£€æŸ¥è„šæœ¬çš„å®Œæ•´è¾“å‡º
4. DNSæŸ¥è¯¢ç»“æžœï¼š`nslookup api.ai-menu.tech`

æˆ‘ä¼šç«‹å³å¸®æ‚¨è§£å†³ï¼

---

## ðŸŽ‰ å®Œæˆæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹ç»“æžœæ—¶ï¼Œè¯´æ˜Žè¿ç§»æˆåŠŸï¼š

```bash
âœ… https://api.ai-menu.tech/health è¿”å›ž {"status":"ok"}
âœ… https://app.ai-menu.tech é¡µé¢æ­£å¸¸
âœ… ç”¨æˆ·æ³¨å†Œã€ç™»å½•åŠŸèƒ½æ­£å¸¸
âœ… AIèœå•ç”ŸæˆåŠŸèƒ½æ­£å¸¸
âœ… æµè§ˆå™¨æŽ§åˆ¶å°æ²¡æœ‰é”™è¯¯
```

**æ­å–œï¼æ‚¨å·²æˆåŠŸä»ŽIPè¿ç§»åˆ°åŸŸåï¼Œå¹¶å¯ç”¨äº†HTTPSï¼** ðŸŽŠ

