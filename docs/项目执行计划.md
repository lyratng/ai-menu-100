# 炊语智能菜单生成系统 - 项目执行计划

## ✅ 已完成

### 📋 规划阶段
- [x] PRD文档完善（解决10个核心问题）
- [x] 技术栈确定（Next.js + Fastify + PostgreSQL）
- [x] Monorepo架构设计
- [x] 项目框架文档更新

### 🏗️ 基础架构
- [x] Monorepo文件夹结构创建
- [x] 根目录配置（package.json、pnpm-workspace.yaml）
- [x] 共享类型库（shared/）
  - [x] 烹饪方法常量和映射（8大类）
  - [x] 菜品类型常量
  - [x] TypeScript类型定义（dish、menu、user、api）

---

## 🚀 下一步工作

### Phase 1: 后端核心（预计3-5天）

#### 1.1 后端项目初始化
- [ ] 初始化Fastify项目（backend/）
- [ ] 配置TypeScript
- [ ] 配置环境变量（.env.example）
- [ ] 创建基础项目结构

#### 1.2 数据库设置
- [ ] 编写PostgreSQL DDL脚本（根据PRD的数据模型）
- [ ] 创建数据库迁移工具
- [ ] 添加pgvector扩展
- [ ] 编写测试数据种子脚本

**数据表（根据PRD）**：
- dishes_common（通用菜库）
- dishes_store（门店专属菜库）
- menus（菜单，上传与生成统一）
- stores（门店）
- users（用户）
- parse_queue（解析队列，新增）
- audit_logs（审计日志）

#### 1.3 认证系统
- [ ] JWT token生成与验证
- [ ] 密码加密（bcrypt）
- [ ] 登录接口 POST /auth/login
- [ ] 注册接口 POST /auth/register
- [ ] Token刷新接口

#### 1.4 核心API接口
- [ ] 门店管理
  - GET /stores
  - POST /stores
  - PATCH /stores/:id
  - DELETE /stores/:id（软删除）
  
- [ ] 菜品管理
  - GET /dishes（查询，支持筛选）
  - POST /dishes
  - GET /dishes/:id
  - PATCH /dishes/:id
  - DELETE /dishes/:id（软删除）
  
- [ ] 菜单上传
  - POST /menu/upload（上传Excel）
  - GET /menu/parse-queue（查询解析队列）
  - POST /menu/reparse/:id（重新解析）

- [ ] 菜单生成
  - POST /menu/generate（生成菜单）
  - GET /menus（历史记录）
  - GET /menus/:id（详情）
  - DELETE /menus/:id（软删除）

#### 1.5 AI集成
- [ ] DeepSeek API封装（services/ai/deepseek.ts）
- [ ] OpenAI API封装（预留接口）
- [ ] Embedding服务（预留）
- [ ] Prompt模板管理

#### 1.6 菜单生成核心逻辑
- [ ] 实现384种标签检索逻辑
- [ ] 历史菜占比计算
- [ ] 菜品不足检查与提示
- [ ] AI调用与结果解析
- [ ] 菜名匹配与标签回填
- [ ] 兜底策略（规则驱动选菜）

#### 1.7 Excel解析
- [ ] Excel文件读取（SheetJS）
- [ ] 结构化提取
- [ ] 调用AI解析菜品标签
- [ ] 写入dishes_store
- [ ] 计算菜单统计参数

#### 1.8 异步任务队列
- [ ] BullMQ配置（workers/queue.ts）
- [ ] 菜单解析任务（workers/parseMenu.ts）
- [ ] 队列状态查询
- [ ] 失败重试机制

#### 1.9 阿里云OSS集成
- [ ] OSS SDK配置
- [ ] 文件上传接口
- [ ] 文件下载接口

---

### Phase 2: 用户前端（预计3-4天）

#### 2.1 项目初始化
- [ ] 创建Next.js项目（frontend/）
- [ ] 配置Tailwind CSS
- [ ] 配置shadcn/ui
- [ ] 配置TanStack Query
- [ ] 配置Zustand

#### 2.2 认证页面
- [ ] 登录页面（/login）
- [ ] 注册页面（/register）
  - 首次注册界面 - 1（账号密码、默认菜品数量）
  - 首次注册界面 - 2（上传历史菜单）
- [ ] 解析状态栏组件（悬浮提示）

#### 2.3 主页（生成菜单）
- [ ] 页面布局（四个书签：早/午/晚/夜）
- [ ] 午餐容器
  - 模式切换（菜品规则判断 vs 菜单相似度匹配）
  - 选项表单（7个选项）
  - 模型选择（DeepSeek/GPT-5）
- [ ] 生成菜单按钮
- [ ] 查看生成菜单按钮
- [ ] 菜单表格展示组件
- [ ] 菜品详情卡片弹窗
- [ ] 下载Excel功能

#### 2.4 历史菜单页面
- [ ] 历史生成菜单列表
- [ ] 历史上传菜单列表
- [ ] 上传新菜单（最多50份）
- [ ] 删除菜单（软删除）

#### 2.5 UI组件库
- [ ] 按照PRD设计系统配置Tailwind
- [ ] shadcn/ui基础组件
- [ ] 自定义组件（菜单表格、上传区域等）

---

### Phase 3: 管理后台（预计4-5天）

#### 3.1 项目初始化
- [ ] 创建Next.js项目（admin/）
- [ ] 配置Tailwind CSS
- [ ] 配置shadcn/ui
- [ ] 配置TanStack Table
- [ ] 配置Recharts

#### 3.2 认证
- [ ] 管理员登录页面

#### 3.3 Dashboard（概览看板）
- [ ] 时间筛选器
- [ ] KPI卡片
- [ ] 图表组件
- [ ] 数据导出

#### 3.4 门店管理
- [ ] 门店列表（服务端分页）
- [ ] 新增门店
- [ ] 修改门店信息
- [ ] 修改门店初始化配置
- [ ] 禁用/启用/软删除

#### 3.5 菜单库
- [ ] 菜单列表（服务端分页、筛选）
- [ ] 菜单详情
- [ ] 软删除

#### 3.6 菜品库
- [ ] 菜品列表（服务端分页、筛选）
- [ ] 菜品详情
- [ ] 菜品合并工具
- [ ] 软删除

#### 3.7 账号管理
- [ ] 账号列表
- [ ] 新增账号
- [ ] 修改账号/密码
- [ ] 禁用/启用

#### 3.8 审计日志
- [ ] 日志列表
- [ ] 筛选与搜索
- [ ] 导出

#### 3.9 导入导出
- [ ] Excel模板下载
- [ ] 批量导入
- [ ] 批量导出

#### 3.10 API Tokens
- [ ] Token生成
- [ ] Token管理
- [ ] 只读API文档

#### 3.11 系统设置
- [ ] 基础开关配置

---

### Phase 4: 部署与测试（预计2-3天）

#### 4.1 本地测试
- [ ] 联调前后端
- [ ] 测试核心功能
- [ ] 修复bug

#### 4.2 阿里云服务配置
- [ ] 购买RDS PostgreSQL（华北2北京）
- [ ] 配置数据库白名单
- [ ] 创建数据库和表
- [ ] 购买OSS存储
- [ ] 购买ECS服务器
- [ ] 配置域名解析

#### 4.3 后端部署
- [ ] 编写Dockerfile
- [ ] 编写docker-compose.yml
- [ ] 配置Nginx
- [ ] 部署到ECS
- [ ] 配置SSL证书（api.ai-menu.tech）

#### 4.4 前端部署
- [ ] Vercel项目配置（frontend）
- [ ] 环境变量配置
- [ ] 域名绑定（app.ai-menu.tech）
- [ ] Vercel项目配置（admin）
- [ ] 域名绑定（admin.ai-menu.tech）

#### 4.5 测试
- [ ] 功能测试
- [ ] 性能测试
- [ ] 国内访问测试（不翻墙）

---

### Phase 5: 数据准备（预计2-3天）

#### 5.1 通用菜品库
- [ ] 准备5000-10000道菜品数据
- [ ] 人工打标签（8个标签）
- [ ] 导入dishes_common表

#### 5.2 测试账号
- [ ] 创建测试门店
- [ ] 创建管理员账号

---

## 📊 开发进度追踪

### 当前阶段
**Phase 0: 基础架构搭建** ✅ 已完成

### 下一阶段
**Phase 1: 后端核心** 🔄 准备开始

### 预计总时长
约 15-20 个工作日

---

## 🔧 技术债务与优化（后续迭代）

### 功能增强
- [ ] 早餐/晚餐/夜宵菜单生成
- [ ] 菜单相似度匹配模式（RAG + pgvector）
- [ ] A/B测试功能
- [ ] Metabase数据看板
- [ ] 移动端优化

### 性能优化
- [ ] Redis缓存策略
- [ ] 数据库索引优化
- [ ] 前端懒加载
- [ ] 图片CDN

### 安全增强
- [ ] 2FA双因素认证
- [ ] API限流
- [ ] SQL注入防护
- [ ] XSS防护

---

## 📝 备注

### 需要用户提供的信息
1. ✅ DeepSeek API Key
2. ❓ OpenAI API Key（预留，暂不需要）
3. ❓ 阿里云账号信息（部署时需要）
4. ❓ 域名ai-menu.tech的DNS管理权限
5. ❓ 通用菜品库数据（5000-10000道菜）

### 关键决策
- ✅ 使用Monorepo架构
- ✅ 分开部署前后端
- ✅ 使用shadcn/ui作为UI组件库
- ✅ 主要使用DeepSeek，OpenAI预留接口
- ✅ MVP不包含早餐/晚餐/夜宵

---

## 🎯 下一步行动

**立即开始**：
1. 初始化backend项目
2. 编写PostgreSQL DDL
3. 实现认证系统

**命令**：
```bash
cd backend
pnpm init
pnpm add fastify @fastify/cors @fastify/jwt
pnpm add -D typescript @types/node tsx
```

