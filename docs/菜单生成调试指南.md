# èœå•ç”Ÿæˆè°ƒè¯•æŒ‡å— - è¶…æ—¶é—®é¢˜æ’æŸ¥

## ä¸€ã€å·²å®Œæˆçš„ä¿®å¤

### âœ… 1. ä¿®å¤Promptç”Ÿæˆé€»è¾‘
**é—®é¢˜**ï¼šä¹‹å‰åªç”Ÿæˆ1å¤©èœå•ï¼ˆå‘¨ä¸€ï¼‰  
**ä¿®å¤**ï¼šç°åœ¨ç”Ÿæˆå®Œæ•´5å¤©èœå•ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰

### âœ… 2. æ·»åŠ å®Œæ•´çš„9æ¡å¼€èœè§„åˆ™
**é—®é¢˜**ï¼šPromptè¿‡äºç®€åŒ–ï¼Œç¼ºå°‘PRDè¦æ±‚çš„è§„åˆ™  
**ä¿®å¤**ï¼šæ·»åŠ äº†å®Œæ•´çš„9æ¡å¼€èœè§„åˆ™åˆ°System Prompt

### âœ… 3. ä¼˜åŒ–èœå“ä¿¡æ¯ä¼ é€’
**é—®é¢˜**ï¼šä¼ é€’æ‰€æœ‰229é“èœå¯¼è‡´Promptè¿‡é•¿ï¼ˆå¯èƒ½è¶…è¿‡10,000å­—ç¬¦ï¼‰  
**ä¿®å¤**ï¼š
- é™åˆ¶æ¯ç§ç±»å‹æœ€å¤šä¼ é€’50é“èœï¼ˆæ€»å…±æœ€å¤š200é“ï¼‰
- ç®€åŒ–èœå“æ ‡ç­¾æ ¼å¼ï¼š`èœåï¼ˆçƒ¹é¥ªÂ·é£ŸæÂ·åˆ€å·¥ï¼‰`
- é¢„è®¡Prompté•¿åº¦ä» ~15000å­—ç¬¦ é™åˆ° ~8000å­—ç¬¦

### âœ… 4. æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—
æ–°å¢è°ƒè¯•æ–­ç‚¹ï¼š
- â±ï¸ æ—¶é—´æˆ³è¿½è¸ªæ¯ä¸ªæ­¥éª¤
- ğŸ“ Prompté•¿åº¦ç»Ÿè®¡
- ğŸ“ Promptå†…å®¹é‡‡æ ·ï¼ˆå‰å500å­—ï¼‰
- ğŸ’° Tokenä½¿ç”¨é‡ç»Ÿè®¡
- âš ï¸ è¶…é™è­¦å‘Š

---

## äºŒã€å¦‚ä½•æŸ¥çœ‹å®æ—¶æ—¥å¿—

### æ–¹æ³•1ï¼šå®æ—¶ç›‘æ§åç«¯æ—¥å¿—ï¼ˆæ¨èï¼‰
```bash
# åœ¨æ–°çš„ç»ˆç«¯çª—å£è¿è¡Œ
tail -f /tmp/backend.log
```

### æ–¹æ³•2ï¼šæŸ¥çœ‹æœ€è¿‘æ—¥å¿—
```bash
tail -100 /tmp/backend.log
```

### æ–¹æ³•3ï¼šè¿‡æ»¤å…³é”®æ—¥å¿—
```bash
tail -100 /tmp/backend.log | grep "ç”Ÿæˆèœå•\|Prompt\|AI\|tokens\|ERROR\|â±ï¸"
```

---

## ä¸‰ã€å…³é”®è°ƒè¯•ä¿¡æ¯è§£è¯»

### ğŸ“Š æ­£å¸¸æµç¨‹æ—¥å¿—ç¤ºä¾‹

```
ğŸ³ å¼€å§‹ç”Ÿæˆèœå•... {store_id: 'xxx', days: 5, ...}
ğŸ“Š æ£€æŸ¥ä¸“å±èœåº“...
ä¸“å±èœåº“æ•°é‡: 0é“
ğŸ” è·å–èœå“æ•°æ®...
æŸ¥è¯¢é€šç”¨èœåº“...
é€šç”¨èœåº“: 229é“
ğŸ“Š èœå“ç±»å‹åˆ†å¸ƒ: {çƒ­èœä¸»è¤: 79, çƒ­èœåŠè¤: 15, çƒ­èœç´ èœ: 129, å‡‰èœ: 6}
âœ… è·å–åˆ° 229 é“èœå“

ğŸ¤– æ„å»ºAI Prompt...
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:22:40.000Z - å¼€å§‹æ„å»ºPrompt
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:22:40.050Z - Promptæ„å»ºå®Œæˆ
ğŸ“ Prompté•¿åº¦: system=1234å­—ç¬¦, user=6789å­—ç¬¦
ğŸ“ æ€»é•¿åº¦: 8023å­—ç¬¦
ğŸ“ æ ¼å¼åŒ–åèœå“ä¿¡æ¯é•¿åº¦: 6500å­—ç¬¦
ğŸ’° é¢„ä¼°tokens: 4012 (å®é™…å¯èƒ½ç•¥æœ‰å·®å¼‚)

ğŸš€ è°ƒç”¨deepseek-chatï¼Œè¯·è€å¿ƒç­‰å¾…...
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:22:40.100Z - å¼€å§‹è°ƒç”¨AI
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:23:15.300Z - AIå“åº”å®Œæˆ
âœ… AIå“åº”æˆåŠŸï¼Œè€—æ—¶: 35200ms (35.2ç§’)
ğŸ“Š AIå“åº”tokens: prompt=4015, completion=1850, total=5865

ğŸ’¾ ä¿å­˜èœå•åˆ°æ•°æ®åº“...
âœ… èœå•è®°å½•å·²ä¿å­˜ï¼ŒID: xxx
ğŸ“ è®°å½•ç”Ÿæˆäº‹ä»¶...
âœ… ç”Ÿæˆäº‹ä»¶å·²è®°å½•
ğŸ‰ èœå•ç”Ÿæˆå®Œæˆï¼
```

### âš ï¸ å¼‚å¸¸æƒ…å†µè¯†åˆ«

#### 1ï¸âƒ£ Promptè¿‡é•¿
```
ğŸ’° é¢„ä¼°tokens: 12500 (å®é™…å¯èƒ½ç•¥æœ‰å·®å¼‚)
âš ï¸  è­¦å‘Šï¼šé¢„ä¼°tokens(12500)å¯èƒ½è¶…è¿‡æ¨¡å‹é™åˆ¶ï¼Œå¯èƒ½å¯¼è‡´è¶…æ—¶
```
**åŸå› **ï¼šèœå“ä¿¡æ¯è¿‡å¤š  
**è§£å†³**ï¼šå·²é™åˆ¶ä¸ºæ¯ç±»æœ€å¤š50é“

#### 2ï¸âƒ£ AIè°ƒç”¨è¶…æ—¶
```
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:22:40.100Z - å¼€å§‹è°ƒç”¨AI
â±ï¸  [æ—¶é—´æˆ³] 2025-11-04T17:24:20.100Z - AIè°ƒç”¨å¤±è´¥
âŒ AIè°ƒç”¨å¤±è´¥: {message: 'AIè°ƒç”¨è¶…æ—¶ï¼ˆ100ç§’ï¼‰', ...}
```
**åŸå› **ï¼š
- ç½‘ç»œé—®é¢˜
- DeepSeekæœåŠ¡ç¹å¿™
- Promptå¤ªå¤æ‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¨åé‡è¯•
3. å¦‚æœæŒç»­å¤±è´¥ï¼Œè¿›ä¸€æ­¥ç®€åŒ–Prompt

#### 3ï¸âƒ£ DeepSeek APIé”™è¯¯
```
âŒ DeepSeek APIé”™è¯¯: {message: 'aborted', code: 'ECONNRESET'}
```
**åŸå› **ï¼šç½‘ç»œè¿æ¥ä¸­æ–­  
**è§£å†³**ï¼šåç«¯å·²é…ç½®è‡ªåŠ¨é‡è¯•2æ¬¡

---

## å››ã€æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1ï¼šæ¸…ç©ºæ—§æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
```bash
> /tmp/backend.log
echo "æ—¥å¿—å·²æ¸…ç©ºï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•"
```

### æ­¥éª¤2ï¼šç›‘æ§æ—¥å¿—
åœ¨ä¸€ä¸ªæ–°ç»ˆç«¯çª—å£è¿è¡Œï¼š
```bash
tail -f /tmp/backend.log
```

### æ­¥éª¤3ï¼šå‰ç«¯ç”Ÿæˆèœå•
1. è®¿é—® http://localhost:3000
2. ç™»å½•
3. ç‚¹å‡»"ç”Ÿæˆèœå•"
4. è§‚å¯Ÿæ—¥å¿—è¾“å‡º

### æ­¥éª¤4ï¼šåˆ†æç»“æœ

**æˆåŠŸæ ‡å¿—**ï¼š
- âœ… çœ‹åˆ° "ğŸ‰ èœå•ç”Ÿæˆå®Œæˆï¼"
- âœ… è€—æ—¶åœ¨ 30-60ç§’ä¹‹é—´
- âœ… å‰ç«¯æ˜¾ç¤º5å¤©å®Œæ•´èœå•

**å¤±è´¥æ ‡å¿—**ï¼š
- âŒ è¶…è¿‡100ç§’æ— å“åº”
- âŒ å‰ç«¯æ˜¾ç¤º "timeout" æˆ– "ç½‘ç»œè¿æ¥å¤±è´¥"
- âŒ åç«¯æ—¥å¿—æ˜¾ç¤º "AIè°ƒç”¨å¤±è´¥"

---

## äº”ã€æ€§èƒ½åŸºå‡†

åŸºäºå½“å‰é…ç½®ï¼ˆ229é“èœï¼Œæ¯ç±»é™50é“ï¼‰ï¼š

| æŒ‡æ ‡ | é¢„æœŸå€¼ | è¯´æ˜ |
|------|--------|------|
| Promptæ€»é•¿åº¦ | ~8000å­—ç¬¦ | system(1200) + user(6800) |
| é¢„ä¼°tokens | ~4000-5000 | ä¸­æ–‡æŒ‰1.5å­—ç¬¦/tokenè®¡ç®— |
| AIå“åº”æ—¶é—´ | 30-60ç§’ | ç”Ÿæˆ5å¤©èœå•ï¼Œæ¯å¤©10-12é“èœ |
| æ€»è€—æ—¶ | 35-65ç§’ | åŒ…æ‹¬æ•°æ®åº“æŸ¥è¯¢+AIè°ƒç”¨+ä¿å­˜ |
| æˆåŠŸç‡ | >90% | DeepSeekç¨³å®šæ€§è¾ƒå¥½ |

---

## å…­ã€å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: å‰ç«¯æ˜¾ç¤ºè¶…æ—¶ï¼Œä½†åç«¯æ—¥å¿—æ²¡æœ‰é”™è¯¯ï¼Ÿ
**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹åç«¯æœ€å100è¡Œæ—¥å¿—
tail -100 /tmp/backend.log

# æŸ¥çœ‹æ˜¯å¦å¡åœ¨æŸä¸ªæ­¥éª¤
grep "â±ï¸" /tmp/backend.log | tail -20
```

**å¯èƒ½åŸå› **ï¼š
- å‰ç«¯timeoutè®¾ç½®è¿‡çŸ­ï¼ˆå·²è®¾ä¸º150ç§’ï¼‰
- åç«¯è¿›ç¨‹å¯èƒ½å´©æºƒäº†

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥åç«¯è¿›ç¨‹
lsof -i :8080

# å¦‚æœæ²¡è¾“å‡ºï¼Œé‡å¯åç«¯
cd /Users/apple/ai-menu-100/backend
pnpm dev > /tmp/backend.log 2>&1 &
```

### Q2: AIä¸€ç›´åœ¨"ç”Ÿæˆä¸­"ï¼Œè¶…è¿‡2åˆ†é’Ÿï¼Ÿ
**å¯èƒ½åŸå› **ï¼šDeepSeek APIå“åº”æ…¢

**è§£å†³**ï¼š
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦åœ¨ç­‰å¾…AIå“åº”
2. ç­‰å¾…æœ€å¤š100ç§’ï¼ˆåç«¯ä¼šè‡ªåŠ¨è¶…æ—¶ï¼‰
3. å¦‚æœå¤±è´¥ï¼Œç¨åé‡è¯•

### Q3: ç”Ÿæˆçš„èœå•åªæœ‰1å¤©æˆ–è€…ç¼ºå¤±ï¼Ÿ
**æ£€æŸ¥**ï¼šåç«¯Promptæ˜¯å¦æ­£ç¡®è¦æ±‚5å¤©

```bash
# æŸ¥çœ‹å‘é€ç»™AIçš„Prompt
grep "User Prompt" /tmp/backend.log | tail -1
```

åº”è¯¥çœ‹åˆ°ï¼š
```
è¯·ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¾“å‡ºä¸€å‘¨äº”å¤©çš„å®Œæ•´èœå•ï¼ˆmonday, tuesday, wednesday, thursday, fridayï¼‰
```

---

## ä¸ƒã€ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®ï¼ˆå¦‚æœä»ç„¶è¶…æ—¶ï¼‰

### é€‰é¡¹Aï¼šè¿›ä¸€æ­¥å‡å°‘èœå“æ•°é‡
ä¿®æ”¹ `backend/src/services/menu.ts` ä¸­çš„ `maxPerType`ï¼š
```typescript
const maxPerType = 30; // ä»50æ”¹ä¸º30
```

### é€‰é¡¹Bï¼šç®€åŒ–AIè¾“å‡ºè¦æ±‚
ä¸è¦æ±‚AIç”Ÿæˆ `description` å’Œ `cookingMethod`ï¼Œåªè¦æ±‚èœåï¼š
```json
{
  "monday": ["èœå1", "èœå2", ...],
  "tuesday": [...],
  ...
}
```

### é€‰é¡¹Cï¼šåˆ†æ‰¹ç”Ÿæˆï¼ˆä¸æ¨èï¼‰
- å…ˆç”Ÿæˆå‘¨ä¸€åˆ°å‘¨ä¸‰
- å†ç”Ÿæˆå‘¨å››åˆ°å‘¨äº”
- åˆå¹¶ç»“æœ

---

## å…«ã€ç«‹å³æ‰§è¡Œå‘½ä»¤

### æ¸…ç©ºæ—¥å¿—å¹¶å¼€å§‹æ–°æµ‹è¯•
```bash
> /tmp/backend.log && echo "âœ… æ—¥å¿—å·²æ¸…ç©º"
```

### ç›‘æ§æ—¥å¿—ï¼ˆä¿æŒè¿è¡Œï¼‰
```bash
tail -f /tmp/backend.log | grep --line-buffered "ğŸ³\|â±ï¸\|âœ…\|âŒ\|ğŸ“\|ğŸ’°"
```

### æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡ç”Ÿæˆçš„è¯¦ç»†ä¿¡æ¯
```bash
tail -200 /tmp/backend.log | grep -A2 -B2 "ç”Ÿæˆèœå•"
```

---

**ç°åœ¨è¯·ï¼š**
1. æ‰“å¼€æ–°ç»ˆç«¯çª—å£ï¼Œè¿è¡Œï¼š`tail -f /tmp/backend.log`
2. åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»"ç”Ÿæˆèœå•"
3. è§‚å¯Ÿæ—¥å¿—è¾“å‡ºï¼Œç‰¹åˆ«æ³¨æ„ï¼š
   - ğŸ“ Prompté•¿åº¦
   - ğŸ’° é¢„ä¼°tokens
   - â±ï¸ å„æ­¥éª¤æ—¶é—´æˆ³
   - âœ… æˆ– âŒ æœ€ç»ˆç»“æœ

4. æŠŠæ—¥å¿—è¾“å‡ºå‘ç»™æˆ‘ï¼Œæˆ‘ä¼šå¸®ä½ åˆ†æå…·ä½“å¡åœ¨å“ªé‡Œï¼

