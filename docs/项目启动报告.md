# 炊语智能菜单生成系统 - 项目启动报告

**报告日期**: 2025年11月2日  
**项目阶段**: Phase 0 完成 ✅  
**当前状态**: 基础架构搭建完成，准备进入开发阶段

---

## ✅ 已完成工作总览

### 1. 需求规划与文档完善

#### 1.1 PRD文档完善
✅ 已解决的10个核心问题：
1. **菜品规则判断 vs 菜单相似度匹配**：现阶段实现规则判断，RAG预留接口
2. **烹饪方式归一**：强制归一到8大类，无法归类的单独记录
3. **初始化菜品数量**：作为默认配置，不预先准备菜库
4. **历史菜单解析**：异步解析，支持重新解析和队列查看
5. **384种标签计算**：修正为4×8×12=384，每种检索10道菜
6. **选项记忆逻辑**：会话期保留，刷新恢复默认，生成时永久保存
7. **AI菜名匹配**：严格逐字匹配，不匹配则留空
8. **组织架构**：只有门店一级，不需要集团层
9. **前端技术栈**：Next.js + shadcn/ui，全响应式
10. **模型选择**：主要用DeepSeek，GPT-5预留接口

#### 1.2 文档更新
- ✅ **项目框架.md**：新增完整技术栈和Monorepo结构
- ✅ **炊语智能菜单生成系统 PRD.md**：修正所有288→384，完善所有细节
- ✅ **项目执行计划.md**：详细的5个阶段开发计划（新建）
- ✅ **第三方服务配置指南.md**：10个服务的完整配置步骤（新建）

---

### 2. Monorepo 架构搭建

#### 2.1 项目结构创建
```
ai-menu-100/
├── frontend/          ✅ 用户前端文件夹（已创建）
├── admin/             ✅ 管理后台文件夹（已创建）
├── backend/           ✅ 后端API文件夹（已创建）
├── shared/            ✅ 共享代码库（已创建并完成）
├── docs/              ✅ 项目文档（已创建并完善）
├── scripts/           ✅ 脚本工具文件夹（已创建）
├── package.json       ✅ 根配置文件
├── pnpm-workspace.yaml ✅ Workspace配置
├── tsconfig.json      ✅ TypeScript配置
├── .gitignore         ✅ Git忽略配置
└── README.md          ✅ 项目说明文档
```

#### 2.2 共享代码库 (shared/) - 100%完成 ✅

**常量定义 (constants/)**:
- ✅ `cookMethods.ts` - 8大烹饪法常量和映射字典
  - 定义了8大烹饪法
  - 40+种烹饪方式到8大类的映射关系
  - `normalizeCookMethod()`归一函数
  
- ✅ `dishTypes.ts` - 菜品类型常量
  - 10种菜品类型
  - 午餐4种类型
  - 8种食材特征
  - 12种刀工
  - 4季节
  - 成本等级、辣度、原材料多样性等

- ✅ `index.ts` - 常量导出

**类型定义 (types/)**:
- ✅ `dish.ts` - 菜品相关类型
  - DishCommon（通用菜库）
  - DishStore（门店专属菜库）
  - CreateDishRequest、UpdateDishRequest
  - DishQueryParams、DishListResponse
  
- ✅ `menu.ts` - 菜单相关类型
  - Menu、MenuItemsJson
  - GenOptionsJson（生成选项）
  - MenuStatsJson（统计数据）
  - GenerateMenuRequest、UploadMenuRequest
  - GenerateMenuResponse
  
- ✅ `user.ts` - 用户相关类型
  - User、Store
  - StoreDefaultConfig（门店初始化配置）
  - RegisterRequest、LoginRequest
  - CreateStoreRequest、UpdateStoreRequest
  
- ✅ `api.ts` - API响应类型
  - ApiResponse、PaginatedResponse
  - ParseQueueItem、ParseQueueResponse
  - HealthCheckResponse
  - ApiErrorCode枚举

- ✅ `index.ts` - 类型导出

**配置文件**:
- ✅ `package.json` - 包配置
- ✅ `tsconfig.json` - TypeScript配置

---

### 3. 技术栈确认

#### 3.1 前端技术栈
```typescript
{
  framework: "Next.js 14+ (App Router)",
  language: "TypeScript 5+",
  styling: "Tailwind CSS 3+",
  ui: "shadcn/ui",
  stateManagement: "Zustand",
  dataFetching: "TanStack Query",
  forms: "React Hook Form + Zod",
  tables: "TanStack Table",
  charts: "Recharts",
  excel: "SheetJS (xlsx)",
  deployment: "Vercel"
}
```

#### 3.2 后端技术栈
```typescript
{
  framework: "Fastify 4+",
  language: "TypeScript 5+",
  database: "PostgreSQL 14+ (pg驱动)",
  vector: "pgvector扩展",
  cache: "Redis 7+",
  auth: "JWT (jsonwebtoken)",
  encryption: "bcrypt",
  storage: "阿里云OSS SDK",
  ai: ["DeepSeek API", "OpenAI API（预留）"],
  queue: "BullMQ + Redis",
  logger: "Pino",
  deployment: "Docker + docker-compose"
}
```

#### 3.3 基础设施
- ✅ 数据库：阿里云RDS PostgreSQL（华北2北京）
- ✅ 对象存储：阿里云OSS（华北2北京）
- ✅ 容器：阿里云ECS + Docker
- ✅ 前端部署：Vercel（两个项目独立部署）
- ✅ CDN：Vercel CDN（国内可用）

---

### 4. 部署架构设计

#### 4.1 域名规划
```
用户前端:   app.ai-menu.tech   → Vercel (frontend/)
管理后台:   admin.ai-menu.tech → Vercel (admin/)
后端API:    api.ai-menu.tech   → 阿里云ECS (backend/)
```

#### 4.2 数据流向
```
用户浏览器 → Vercel CDN (中国节点) → Next.js SSR
                                    ↓
                            Fetch API请求
                                    ↓
                            阿里云ECS Fastify
                                    ↓
                    ┌───────────────┼───────────────┐
                    ↓               ↓               ↓
              RDS PostgreSQL    Redis队列      OSS存储
                    ↑
                    │ AI调用
                    ↓
              DeepSeek API
```

---

## 📋 项目文件清单

### 根目录配置文件
- ✅ `package.json` - Workspace脚本配置
- ✅ `pnpm-workspace.yaml` - pnpm workspace配置
- ✅ `tsconfig.json` - 根TypeScript配置
- ✅ `.gitignore` - Git忽略规则
- ✅ `README.md` - 项目说明文档

### 文档 (docs/)
- ✅ `项目框架.md` - 完整技术架构（已更新）
- ✅ `炊语智能菜单生成系统 PRD.md` - 产品需求文档（已完善）
- ✅ `项目执行计划.md` - 5阶段开发计划（新建）
- ✅ `第三方服务配置指南.md` - 10个服务配置步骤（新建）
- ✅ `项目启动报告.md` - 本文档（新建）

### 共享代码 (shared/)
- ✅ 8个TypeScript文件（常量+类型）
- ✅ package.json + tsconfig.json

---

## 🎯 下一步工作（Phase 1）

### 立即开始：后端核心开发

#### Step 1: 初始化Backend项目
```bash
cd backend
pnpm init
pnpm add fastify @fastify/cors @fastify/jwt @fastify/multipart
pnpm add pg bcrypt jsonwebtoken ali-oss bullmq
pnpm add -D typescript @types/node @types/pg @types/bcrypt tsx nodemon
```

#### Step 2: 编写数据库DDL
根据PRD的数据模型，创建完整的PostgreSQL建表脚本：
- dishes_common（通用菜库）
- dishes_store（门店专属菜库）
- menus（菜单统一表）
- stores（门店）
- users（用户）
- parse_queue（解析队列）
- audit_logs（审计日志）

#### Step 3: 实现认证系统
- JWT token生成与验证
- 注册/登录接口
- 密码加密

#### Step 4: 实现核心API
- 门店管理
- 菜品管理
- 菜单上传（Excel）
- 菜单生成（AI）

**预计时间**：3-5天

---

## 📊 进度追踪

### Phase 0: 基础架构搭建 ✅ 100%
- [x] 需求分析与文档完善
- [x] Monorepo结构设计
- [x] 共享代码库完成
- [x] 技术栈确认
- [x] 部署架构设计
- [x] 配置文件创建

### Phase 1: 后端核心 🔄 0%
- [ ] Backend项目初始化
- [ ] 数据库DDL编写
- [ ] 认证系统
- [ ] 核心API接口
- [ ] AI集成
- [ ] 菜单生成逻辑
- [ ] Excel解析
- [ ] 异步任务队列
- [ ] OSS集成

### Phase 2: 用户前端 ⏸️ 0%
### Phase 3: 管理后台 ⏸️ 0%
### Phase 4: 部署与测试 ⏸️ 0%
### Phase 5: 数据准备 ⏸️ 0%

---

## 🔑 关键决策记录

| 决策项 | 最终方案 | 理由 |
|--------|----------|------|
| 项目架构 | Monorepo | 类型共享、版本统一、代码复用 |
| 前后端部署 | 分开部署 | 权限隔离清晰，无数据共享困难 |
| 前端框架 | Next.js 14 | 国内CDN可用、SSR性能好、生态成熟 |
| UI组件库 | shadcn/ui | 极简风格、完全可定制、无依赖膨胀 |
| 后端框架 | Fastify | 性能高、TypeScript友好 |
| AI服务 | DeepSeek为主 | 国内可用、成本低、效果好 |
| 菜单生成 | 先做规则判断模式 | MVP快速上线，RAG预留接口 |
| MVP范围 | 只做午餐 | 聚焦核心功能，快速验证 |

---

## 💡 技术亮点

1. **类型安全**：前后端共享TypeScript类型定义
2. **8大烹饪法归一**：智能映射40+种烹饪方式
3. **异步解析**：不阻塞用户，队列化处理
4. **严格菜名匹配**：确保生成菜品可追溯
4. **Monorepo管理**：一次提交，全栈更新
5. **响应式设计**：手机、平板、桌面全适配
6. **国内友好**：Vercel CDN + DeepSeek，不翻墙可用

---

## 📞 需要您提供的信息

在开始Phase 1之前，请准备以下信息（不着急，开发过程中随时提供）：

### 必需（开发阶段）
1. **DeepSeek API Key**（立即需要）
   - 用于AI菜单生成和解析
   - 申请地址：https://platform.deepseek.com/
   
2. **阿里云账号信息**（部署阶段需要）
   - AccessKey ID 和 Secret
   - 用于RDS、OSS、ECS配置

3. **域名DNS管理权限**（部署阶段需要）
   - ai-menu.tech
   - 需要配置3个子域名的DNS记录

### 可选（生产阶段）
4. **OpenAI API Key**（预留，暂不需要）
5. **通用菜品库数据**（5000-10000道菜，可后续提供）

---

## ✨ 项目特色

### 对比传统方案的优势
1. **技术现代化**：App Router、Server Component、TypeScript 5
2. **开发效率高**：Monorepo、类型共享、shadcn/ui
3. **国内适配好**：Vercel CDN、DeepSeek API、阿里云全家桶
4. **可扩展性强**：RAG预留、embedding预留、A/B测试预留
5. **文档完善**：5份详细文档、清晰的执行计划

---

## 🚀 准备开始开发！

**当前状态**：所有前置工作已完成 ✅  
**下一步**：初始化Backend项目并开始编码  
**预计完成时间**：15-20个工作日

---

## 📝 备注

如有任何问题，请随时提出！我会：
1. 实时解答技术问题
2. 协助配置第三方服务
3. 调整开发计划
4. 提供代码示例

**联系方式**：通过当前对话窗口

---

**报告生成时间**：2025年11月2日  
**报告生成者**：AI开发助手  
**项目状态**：🟢 进展顺利

